
WARNING: This tool is almost entirely vibe-coded. Some of the test code has
never been read by a human. The actual code has been read but not carefully.

Simple single-node test runner. Runs test commands and aggregates results. This
runs locally on the target machine, so if the machine is broken it will just get
stuck. It basically serves to smooth over crap/inconsistent test interfaces, it
doesn't really solve much else about functional kernel testing.

It's configured by a JSON file like:

```json
{
    "suite": {
        "test": {
            "__is_test": true,
            "command": ["echo", "hello world"]
        }
    }
}
```

That is, an arbitrarily nested structure, where the leaves are marked with
`__is_test`. Then you use a dotted notation to identify the tests to run:

```sh
test-runner --test-config tests.json suite.test
```

You can specify multiple test identifiers as positional arguments. Globs are
supported.

## Test Tags

Tests can be tagged for categorization and selective execution:

```json
{
    "suite": {
        "tags": ["applied_to_whole_suite"],
        "fast_test": {
            "__is_test": true,
            "command": ["echo", "quick test"]
        },
        "slow_test": {
            "__is_test": true,
            "command": ["sleep", "5"],
            "tags": ["slow"]
        },
        "flaky_test": {
            "__is_test": true,
            "command": ["echo", "unreliable test"],
            "tags": ["slow", "flaky"]
        }
    }
}
```

Skip tests with specific tags using `--skip-tag` (repeatable):

```sh
# Skip all slow tests
test-runner --test-config tests.json --skip-tag slow suite.*

# Skip multiple types of tests
test-runner --test-config tests.json --skip-tag slow --skip-tag flaky suite.*

# Mix with specific test selection
test-runner --test-config tests.json --skip-tag flaky suite.fast_test suite.slow_test
```

## Bad Tags

A global `bad_tags` field can be added to the test config. Tests with these tags
will be skipped by default.

```json
{
    "bad_tags": ["bad", "also-bad"],
    "suite": {
        "test": {
            "__is_test": true,
            "command": ["echo", "hello world"],
            "tags": ["bad"]
        }
    }
}
```

They can be enabled by setting `--include-bad`. `--include-bad` with no extra
args will enable all bad tests, `--include-bad` with an argument enables a
specific bad tag. When used with an argument it can be repeated.

```sh
# Include all bad tests
test-runner --test-config tests.json --include-bad suite.*

# Include only tests with the "bad" tag
test-runner --test-config tests.json --include-bad bad suite.*
```

## Bail on Failure

The `--bail-on-failure` flag stops the test runner immediately after the first
test failure. All the remaining tests will show up as SKIP.

```sh
test-runner --test-config tests.json --bail-on-failure suite.*
```

## Kselftest Integration

The `parse-kselftest-list` subcommand can be used to generate a test config from
the kselftest-list.txt file generated by the kselftests makefiles.
