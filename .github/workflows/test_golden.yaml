name: "Run test-golden"
on:
  workflow_call:
  pull_request:
  push:
jobs:
  tests:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v5
    - uses: DeterminateSystems/nix-installer-action@main
    - uses: DeterminateSystems/magic-nix-cache-action@main
      with:
        use-flakehub: false
    - run: mkdir /tmp/limmat-db
    - run: nix run .#test-golden -- /tmp/limmat-db
    - uses: actions/upload-artifact@v4
      if: ${{ !cancelled() }}       # run this step even if previous step failed
      with:
        name: limmat-db
        path: /tmp/limmat-db
    - uses: dorny/test-reporter@v2
      if: ${{ !cancelled() }}       # run this step even if previous step failed
      with:
        path: /tmp/limmat-db/**/junit.xml
        name: limmat-test-golden
        reporter: jest-junit